<categories-menu id="categories-menu-drawer" class="drawer drawer--from-right">
  <span class="drawer__overlay"></span>

  <div class="drawer__header drawer__header--shadowed">
    <button type="button" class="drawer__close-button drawer__close-button--block tap-area" data-action="close">
      <svg width="14" height="14" viewBox="0 0 14 14"><path d="M13 13L1 1M13 1L1 13" stroke="currentColor" stroke-width="2" fill="none"></path></svg>
    </button>
  </div>

  <div class="drawer__content drawer-flex">
    <!-- Menu principal à gauche -->
    <ul class="categories-nav categories-nav-main list--unstyled" role="list">
      {%- for link in section.settings.menu_categories.links -%}
        <li class="categories-nav__item" data-level="1">
          {%- if link.links != blank -%}
            <button class="categories-nav__link_main js-open-submenu" data-target="submenu-{{ forloop.index }}">
              <span>{{ link.title }}</span>
              <span class="arrow">›</span>
            </button>
          {%- else -%}
            <a href="{{ link.url }}" class="categories-nav__link_main">{{ link.title }}</a>
          {%- endif -%}
        </li>
      {%- endfor -%}
    </ul>

    <!-- Bloc des sous-catégories à droite -->
    <div class="categories-submenu">
      {%- for link in section.settings.menu_categories.links -%}
        {%- if link.links != blank -%}
        <ul id="submenu-{{ forloop.index }}" class="subcategories-nav list--unstyled" style="display:none;">
          <li class="submenu-header">{{ link.title }}</li>
          {%- for childlink in link.links -%}
            {%- if childlink.links != blank -%}
              <li>
                <button class="categories-nav__link_child js-toggle-submenu" data-target="sub-submenu-{{ forloop.index }}">
                  <span>{{ childlink.title }}</span>
                  <span class="arrow">›</span>
                </button>
                <ul id="sub-submenu-{{ forloop.index }}" class="sub-subcategories-nav" style="display:none;">
                  {%- for grandchild in childlink.links -%}
                    <li><a href="{{ grandchild.url }}">{{ grandchild.title }}</a></li>
                  {%- endfor -%}
                </ul>
              </li>
            {%- else -%}
              <li><a href="{{ childlink.url }}">{{ childlink.title }}</a></li>
            {%- endif -%}
          {%- endfor -%}
        </ul>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
  <script>
document.addEventListener('DOMContentLoaded', () => {
  // Ouvrir le bloc de sous-catégories
  document.querySelectorAll('.js-open-submenu').forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();

      // Cacher tous les autres sous-menus
      document.querySelectorAll('.subcategories-nav').forEach(sub => sub.style.display = 'none');

      const targetId = btn.dataset.target;
      const submenu = document.getElementById(targetId);
      if(submenu) submenu.style.display = 'block';
    });
  });

  // Ouvrir les sous-sous-catégories
  document.querySelectorAll('.js-toggle-submenu').forEach(btn => {
    btn.addEventListener('click', e => {
      e.preventDefault();
      const targetId = btn.dataset.target;
      const subsubmenu = document.getElementById(targetId);
      if(subsubmenu) subsubmenu.style.display = subsubmenu.style.display === 'none' ? 'block' : 'none';
    });
  });
});
</script>
</categories-menu>
