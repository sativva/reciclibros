<categories-menu id="categories-menu-drawer" class="drawer drawer--from-right">
  <span class="drawer__overlay"></span>

  <!-- HEADER -->
  <div class="drawer__header drawer__header--shadowed">
    <button type="button" class="drawer__close-button drawer__close-button--block tap-area" data-action="close" title="Close">
      <svg focusable="false" width="14" height="14" class="icon icon--close" viewBox="0 0 14 14">
        <path d="M13 13L1 1M13 1L1 13" stroke="currentColor" stroke-width="2" fill="none"></path>
      </svg>
    </button>
  </div>

  <!-- CONTENT -->
  <div class="drawer__content">
    <div class="categories-nav-wrapper" style="overflow:hidden; position:relative;">
      <ul class="categories-nav-main list--unstyled" role="list" style="display:flex; width:300%; transition: transform 0.4s ease;">
        {%- assign level_index = 0 -%}
        {%- for link in section.settings.menu_categories.links -%}
          {%- assign level_index = forloop.index -%}
          <li class="categories-nav__item categories-nav__item-main" data-level="1" style="width:100%; flex-shrink:0;">
            {% if link.links != blank %}
              <button class="categories-nav__link_main mega-existed" data-level="1">
                <div class="categories-nav__link_main-texticon">
                  {%- render 'processMenuTitle' , itemName: link.title -%}
                  {%- render 'processMenuLabel' , itemName: link.title -%}
                </div>
                <span class="animated-plus"></span>
              </button>

              <ul class="categories-nav level-2 list--unstyled" style="width:100%; flex-shrink:0;">
                <li class="back-button"><button>← Retour</button></li>
                {%- for childlink in link.links -%}
                  <li class="categories-nav__item categories-nav__item_mega">
                    {% if childlink.links != blank %}
                      <button class="categories-nav__link_mega" data-level="2">
                        <a href="{{ childlink.url }}" class="categories-meganav__link">{%- render 'processMenuTitle' , itemName: childlink.title -%}</a>
                        <span class="animated-plus"></span>
                      </button>
                      <ul class="categories-nav level-3 list--unstyled" style="width:100%; flex-shrink:0;">
                        <li class="back-button"><button>← Retour</button></li>
                        {%- for grandchildlink in childlink.links -%}
                          <li>
                            <a href="{{ grandchildlink.url }}" class="categories-meganav__link">{%- render 'processMenuTitle' , itemName: grandchildlink.title -%}</a>
                          </li>
                        {%- endfor -%}
                      </ul>
                    {% else %}
                      <a href="{{ childlink.url }}" class="categories-meganav__link">{%- render 'processMenuTitle' , itemName: childlink.title -%}</a>
                    {% endif %}
                  </li>
                {%- endfor -%}
              </ul>

            {% else %}
              <a class="categories-nav__link_main link--animated" href="{{ link.url }}">
                {%- render 'processMenuTitle' , itemName: link.title -%}
              </a>
            {% endif %}
          </li>
        {%- endfor -%}
      </ul>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="drawer__footer drawer__footer--tight drawer__footer--bordered">
    <div class="categories-nav__footer">
      <a class="icon-text" href="/account/login">
        <svg focusable="false" width="18" height="17" class="icon icon--header-customer" viewBox="0 0 18 17">
          <circle cx="9" cy="5" r="4" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"></circle>
          <path d="M1 17v0a4 4 0 014-4h8a4 4 0 014 4v0" fill="none" stroke="currentColor" stroke-width="2"></path>
        </svg>
        Account
      </a>
    </div>
  </div>

  <!-- JS -->
  <script>
  document.addEventListener('DOMContentLoaded', function () {
    const menuWrapper = document.querySelector('.categories-nav-main');
    if (!menuWrapper) return;

    // Remplacer + par >
    document.querySelectorAll('.animated-plus').forEach(span => {
      span.textContent = '›';
    });

    // Navigation slide
    document.querySelectorAll('.mega-existed > button').forEach(btn => {
      btn.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
        const level2 = btn.nextElementSibling;
        if(level2) {
          level2.style.display = 'flex';
          menuWrapper.style.transform = 'translateX(-100%)';
        }
      });
    });

    // Bouton retour
    document.querySelectorAll('.back-button button').forEach(btn => {
      btn.addEventListener('click', function () {
        menuWrapper.style.transform = 'translateX(0)';
      });
    });
  });
  </script>
</categories-menu>
